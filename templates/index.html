{% extends 'base.html' %}
{% block content %}
<div class="row">
    <div class="col-md-6">
        <div class="card p-4 shadow-sm border-primary">
            <h4 class="mb-3">📂 שלב א': טעינת נתונים</h4>
            <p class="small text-muted">בחר את הקבצים מהמחשב כדי לאתחל את המערכת:</p>
            
            <form action="/upload" method="post" enctype="multipart/form-data">
                <div class="mb-3">
                    <label class="form-label fw-bold">קובץ תשובות סטודנטים (CSV):</label>
                    <input type="file" name="students_file" class="form-control" accept=".csv" required>
                </div>
                
                <div class="mb-3">
                    <label class="form-label fw-bold">קובץ פרופיל יחידות (CSV):</label>
                    <input type="file" name="units_file" class="form-control" accept=".csv" required>
                </div>
                
                <button type="submit" class="btn btn-primary w-100">טען נתונים למערכת ⬆️</button>
            </form>
            
            {% if student_count > 0 %}
            <div class="alert alert-success mt-3 py-2">
                ✅ במערכת קיימים נתונים של <strong>{{ student_count }}</strong> סטודנטים.
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card p-4 shadow-sm">
            <h4 class="mb-3">⭐ שלב ב': דירוג יחידות</h4>
            <p class="small text-muted">לחץ על יחידה כדי להזין את דירוג הסטודנטים מהראיונות:</p>
            
            <div class="list-group">
                {% for unit in units %}
                <a href="/rank/{{ unit }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span>{{ unit }}</span>
                    <span class="badge bg-outline-primary text-primary border">ערוך דירוג ✏️</span>
                </a>
                {% else %}
                <div class="text-center p-4 text-muted border sorted">
                    טרם נטענו יחידות. העלה קבצים מימין.
                </div>
                {% endfor %}
            </div>
            
            {% if units %}
            <hr>
            <h5 class="mb-3 mt-4">🎯 שלב ג': הרצת שיבוץ</h5>
            
            <div class="d-grid gap-2">
                <a href="/run" class="btn btn-warning btn-lg">
                    ⚡ ריצה רגילה
                    <br><small class="d-block" style="font-size: 0.75em;">מוצא רק Gamma אופטימלי, משתמש ב-Power שהזנת</small>
                </a>
                
                <a href="/run_full_optimization" class="btn btn-danger btn-lg">
                    🚀 אופטימיזציה מלאה
                    <br><small class="d-block" style="font-size: 0.75em;">מוצא גם Gamma וגם Power אופטימליים (שומר יחידות עם כוח ברזל)</small>
                </a>
            </div>
            
            <div class="alert alert-info mt-3 small">
                💡 <strong>טיפ:</strong> השתמש ב"אופטימיזציה מלאה" כדי למצוא את הערכים הטובים ביותר שמשבצים את מקסימום הסטודנטים. 
                יחידות עם "כוח ברזל" ישמרו את הערכים שלהן.
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}