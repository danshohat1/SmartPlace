{% extends 'base.html' %}
{% block content %}

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-md-12">
            <h2> 驻专驻 住: {{ student_name }}</h2>
        </div>
    </div>

    <!-- 住住拽 住住转 -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="alert alert-info">
                <strong> 住住拽:</strong> 
                专 砖: <strong>{{ rating_count }}/11</strong> | 
                爪注 专: <strong>{{ "%.2f"|format(avg_rating) }}</strong> | 
                Voice: <strong>{{ student.voice }}</strong>
            </div>
        </div>
    </div>

    <!-- 爪转 专 (拽专 砖 住) -->
    <div class="row mb-4">
        <div class="col-md-12">
            <h4> 专 住 (注 11 砖转)</h4>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>#</th>
                            <th>砖</th>
                            <th>专</th>
                            <th>专</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for idx, rating in enumerate(ratings, 1) %}
                        <tr>
                            <td><strong>{{ idx }}</strong></td>
                            <td>砖 {{ idx }}</td>
                            <td>
                                {% if rating %}
                                    <span class="badge bg-primary" style="font-size: 1.1em;">{{ rating }}</span>
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if rating == 1 %}
                                    <span class="badge bg-success"> </span>
                                {% elif rating == 2 %}
                                    <span class="badge bg-info"> </span>
                                {% elif rating >= 3 %}
                                    <span class="badge bg-warning"> </span>
                                {% else %}
                                    <span class="text-muted"> </span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- 住专 注驻转 转 (住专 驻 拽专) -->
    <div class="row mb-4">
        <div class="col-md-12">
            <h4> 住专 注驻转 转 (驻 拽专 专 住)</h4>
            <div class="list-group">
                {% for idx, unit_name in enumerate(prefs, 1) %}
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-1">
                            <span class="badge bg-primary me-2">{{ idx }}</span>
                            {{ unit_name }}
                        </h6>
                        {% if units_data.get(unit_name) %}
                            <small class="text-muted">
                                拽转: {{ units_data[unit_name].capacity }} | 
                                : {{ "%.2f"|format(units_data[unit_name].power) }}
                            </small>
                        {% endif %}
                    </div>
                    <span class="badge bg-secondary">专 {{ idx }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- 爪 砖 拽专 -->
    <div class="row mb-4">
        <div class="col-md-12">
            <h4> 爪 - 拽专 专</h4>
            <div class="card shadow-sm">
                <div class="card-body">
                    <div style="display: flex; gap: 5px; align-items: flex-end; height: 200px; padding: 20px 0;">
                        {% for idx, rating in enumerate(ratings, 1) %}
                        <div style="flex: 1; text-align: center;">
                            <div style="background: linear-gradient(to top, #0d6efd, #0dcaf0); height: {{ (rating or 0) * 20 }}px; width: 100%; border-radius: 4px; position: relative;">
                            </div>
                            <small style="display: block; margin-top: 5px;">
                                Q{{ idx }}<br>
                                <strong>{{ rating or '-' }}</strong>
                            </small>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-5">
        <div class="col-md-12">
            <a href="/" class="btn btn-outline-secondary"> 专 注 转</a>
        </div>
    </div>
</div>

{% endblock %}
